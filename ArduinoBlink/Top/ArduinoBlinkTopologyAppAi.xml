<?xml version='1.0' encoding='UTF-8'?>
<?xml-model href="../../fprime/Autocoders/Python/schema/default/topology_schema.rng" type="application/xml" schematypens="http://relaxng.org/ns/structure/1.0"?>
<assembly name="ArduinoBlink">

    <!-- Import component declarations -->

    <import_component_type>ArduinoBlink/LedBlinker/LedBlinkerComponentAi.xml</import_component_type>
    <import_component_type>ATmega/Drv/ATmegaGpioDriver/ATmegaGpioDriverComponentAi.xml</import_component_type>
    <import_component_type>ATmega/Drv/ATmegaSerialDriver/ATmegaSerialDriverComponentAi.xml</import_component_type>
    <import_component_type>ATmega/Drv/HardwareRateDriver/HardwareRateDriverComponentAi.xml</import_component_type>
    <import_component_type>ATmega/Svc/AssertReset/AssertResetComponentAi.xml</import_component_type>
    <import_component_type>ATmega/Svc/EePrmDb/EePrmDbComponentAi.xml</import_component_type>
    <import_component_type>Svc/ActiveLogger/ActiveLoggerComponentAi.xml</import_component_type>
    <import_component_type>Svc/ActiveRateGroup/ActiveRateGroupComponentAi.xml</import_component_type>
    <import_component_type>Svc/CmdDispatcher/CommandDispatcherComponentAi.xml</import_component_type>
    <import_component_type>Svc/GroundInterface/GroundInterfaceComponentAi.xml</import_component_type>
    <import_component_type>Svc/RateGroupDriver/RateGroupDriverComponentAi.xml</import_component_type>
    <import_component_type>Svc/Time/TimeComponentAi.xml</import_component_type>
    <import_component_type>Svc/TlmChan/TlmChanComponentAi.xml</import_component_type>

    <!-- Declare component instances - must match names in Components.hpp -->

    <!-- Core C&DH Components -->

    <instance namespace="ATmega" name="assertResetter" type="AssertReset" base_id="1" base_id_window="20"/>
    <instance namespace="Svc" name="cmdDisp" type="CommandDispatcher" base_id="41" base_id_window="20"/>
    <instance namespace="Svc" name="chanTlm" type="TlmChan" base_id="81" base_id_window="20"/>
    <instance namespace="Svc" name="eventLogger" type="ActiveLogger" base_id="121" base_id_window="20"/>
    <instance namespace="ATmega" name="eePrmDb" type="EePrmDb" base_id="161" base_id_window="20"/>
    <instance namespace="Svc" name="arduinoTime" type="Time" base_id="201" base_id_window="20"/>
    <instance namespace="Svc" name="groundInterface" type="GroundInterface" base_id="241" base_id_window="20"/>

    <!-- Communications driver. May be swapped with other comm drivers like UART -->

    <instance namespace="Drv" name="uartDriver" type="ATmegaSerialDriver" base_id="281" base_id_window="20"/>

    <!-- Rate Group Components -->

    <instance namespace="Svc" name="rateGroupDriverComp" type="RateGroupDriver" base_id="321" base_id_window="20"/>
    <instance namespace="Svc" name="rateGroup1Comp" type="ActiveRateGroup" base_id="361" base_id_window="20"/>

    <!-- Arduino Blink Components -->

    <instance namespace="Arduino" name="hardwareRateDriver" type="HardwareRateDriver" base_id="401" base_id_window="20"/>
    <instance namespace="Drv" name="ledGpio" type="ATmegaGpioDriver" base_id="441" base_id_window="20"/>
    <instance namespace="ArduinoBlink" name="ledBlinker" type="LedBlinker" base_id="481" base_id_window="20"/>

    <!-- Connections -->

    <!-- Communications driver connections -->

    <connection name="CommunicationRecv">
        <source component="groundInterface" port="readPoll" type="Fw::BufferSend" num="0"/>
        <target component="uartDriver" port="serialRecvFwBuf" type="Fw::BufferSend" num="0"/>
    </connection>
    <connection name="CommunicationSend">
        <source component="groundInterface" port="write" type="Fw::BufferSend" num="0"/>
        <target component="uartDriver" port="serialSendFwBuf" type="Fw::BufferSend" num="0"/>
    </connection>

    <!-- Uplink data connections -->

    <connection name="UplinkCommands">
        <source component="groundInterface" port="uplinkPort" type="Com" num="0"/>
        <target component="cmdDisp" port="seqCmdBuff" type="Com" num="0"/>
    </connection>

    <!-- Downlink ports -->


    <!-- Downlink data connections -->

    <connection name="eventLoggerPkts">
        <source component="eventLogger" port="PktSend" type="Com" num="0"/>
        <target component="groundInterface" port="downlinkPort" type="Com" num="0"/>
    </connection>
    <connection name="chanTlmPkts">
        <source component="chanTlm" port="PktSend" type="Com" num="0"/>
        <target component="groundInterface" port="downlinkPort" type="Com" num="0"/>
    </connection>

    <!-- Command Registration/Dispatch/Reply Connections -->

    <!-- Command Registration Ports - Registration port number must match dispatch port for each component -->

    <connection name="cmdDispCmdReg">
        <source component="cmdDisp" port="CmdReg" type="CmdReg" num="0"/>
        <target component="cmdDisp" port="compCmdReg" type="CmdReg" num="0"/>
    </connection>
    <connection name="eventLoggerCmdReg">
        <source component="eventLogger" port="CmdReg" type="CmdReg" num="0"/>
        <target component="cmdDisp" port="compCmdReg" type="CmdReg" num="1"/>
    </connection>
    <connection name="eePrmDbCmdReg">
        <source component="eePrmDb" port="CmdReg" type="CmdReg" num="0"/>
        <target component="cmdDisp" port="compCmdReg" type="CmdReg" num="2"/>
    </connection>
    <connection name="ledBlinkerCmdReg">
        <source component="ledBlinker" port="CmdReg" type="CmdReg" num="0"/>
        <target component="cmdDisp" port="compCmdReg" type="CmdReg" num="3"/>
    </connection>

    <!-- Command Dispatch Ports - Dispatch port number must match registration port for each component -->

    <connection name="cmdDispCmdDisp">
        <source component="cmdDisp" port="compCmdSend" type="Cmd" num="0"/>
        <target component="cmdDisp" port="CmdDisp" type="Cmd" num="0"/>
    </connection>
    <connection name="eventLoggerCmdDisp">
        <source component="cmdDisp" port="compCmdSend" type="Cmd" num="1"/>
        <target component="eventLogger" port="CmdDisp" type="Cmd" num="0"/>
    </connection>
    <connection name="eePrmDbCmdDisp">
        <source component="cmdDisp" port="compCmdSend" type="Cmd" num="2"/>
        <target component="eePrmDb" port="CmdDisp" type="Cmd" num="0"/>
    </connection>
    <connection name="ledBlinkerCmdDisp">
        <source component="cmdDisp" port="compCmdSend" type="Cmd" num="3"/>
        <target component="ledBlinker" port="CmdDisp" type="Cmd" num="0"/>
    </connection>

    <!-- Command Reply Ports - Go to the same response port on the dispatcher -->

    <connection name="cmdDispCmdReply">
        <source component="cmdDisp" port="CmdStatus" type="CmdResponse" num="0"/>
        <target component="cmdDisp" port="compCmdStat" type="CmdResponse" num="0"/>
    </connection>
    <connection name="eventLoggerCmdReply">
        <source component="eventLogger" port="CmdStatus" type="CmdResponse" num="0"/>
        <target component="cmdDisp" port="compCmdStat" type="CmdResponse" num="0"/>
    </connection>
    <connection name="eePrmDbCmdReply">
        <source component="eePrmDb" port="CmdStatus" type="CmdResponse" num="0"/>
        <target component="cmdDisp" port="compCmdStat" type="CmdResponse" num="0"/>
    </connection>
    <connection name="ledBlinkerCmdReply">
        <source component="ledBlinker" port="CmdStatus" type="CmdResponse" num="0"/>
        <target component="cmdDisp" port="compCmdStat" type="CmdResponse" num="0"/>
    </connection>

    <!-- Sequencer Connections - should not conflict with uplink port -->


    <!-- Event Logger Binary Connections -->

    <connection name="rateGroup1CompLog">
        <source component="rateGroup1Comp" port="Log" type="Log" num="0"/>
        <target component="eventLogger" port="LogRecv" type="Log" num="0"/>
    </connection>
    <connection name="cmdDispLog">
        <source component="cmdDisp" port="Log" type="Log" num="0"/>
        <target component="eventLogger" port="LogRecv" type="Log" num="0"/>
    </connection>
    <connection name="eventLoggerLog">
        <source component="eventLogger" port="Log" type="Log" num="0"/>
        <target component="eventLogger" port="LogRecv" type="Log" num="0"/>
    </connection>
    <connection name="eePrmDbLog">
        <source component="eePrmDb" port="Log" type="Log" num="0"/>
        <target component="eventLogger" port="LogRecv" type="Log" num="0"/>
    </connection>
    <connection name="groundInterfaceLog">
        <source component="groundInterface" port="Log" type="Log" num="0"/>
        <target component="eventLogger" port="LogRecv" type="Log" num="0"/>
    </connection>
    <connection name="ledBlinkerLog">
        <source component="ledBlinker" port="Log" type="Log" num="0"/>
        <target component="eventLogger" port="LogRecv" type="Log" num="0"/>
    </connection>

    <!-- Event Logger Text Connections -->


    <!-- Telemetry Connections -->

    <connection name="rateGroup1CompTlm">
        <source component="rateGroup1Comp" port="Tlm" type="Tlm" num="0"/>
        <target component="chanTlm" port="TlmRecv" type="Tlm" num="0"/>
    </connection>
    <connection name="cmdDispTlm">
        <source component="cmdDisp" port="Tlm" type="Tlm" num="0"/>
        <target component="chanTlm" port="TlmRecv" type="Tlm" num="0"/>
    </connection>
    <connection name="uartDriverTlm">
        <source component="uartDriver" port="Tlm" type="Tlm" num="0"/>
        <target component="chanTlm" port="TlmRecv" type="Tlm" num="0"/>
    </connection>
    <connection name="ledBlinkerTlm">
        <source component="ledBlinker" port="Tlm" type="Tlm" num="0"/>
        <target component="chanTlm" port="TlmRecv" type="Tlm" num="0"/>
    </connection>

    <!-- Parameter Connections -->

    <connection name="ledBlinkerPrmGet">
        <source component="ledBlinker" port="ParamGet" type="PrmGet" num="0"/>
        <target component="eePrmDb" port="getPrm" type="PrmGet" num="0"/>
    </connection>
    <connection name="ledBlinkerPrmSet">
        <source component="ledBlinker" port="ParamSet" type="PrmSet" num="0"/>
        <target component="eePrmDb" port="setPrm" type="PrmSet" num="0"/>
    </connection>

    <!-- Time Connections -->

    <connection name="rateGroup1CompTime">
        <source component="rateGroup1Comp" port="Time" type="Time" num="0"/>
        <target component="arduinoTime" port="timeGetPort" type="Time" num="0"/>
    </connection>
    <connection name="cmdDispTime">
        <source component="cmdDisp" port="Time" type="Time" num="0"/>
        <target component="arduinoTime" port="timeGetPort" type="Time" num="0"/>
    </connection>
    <connection name="eventLoggerTime">
        <source component="eventLogger" port="Time" type="Time" num="0"/>
        <target component="arduinoTime" port="timeGetPort" type="Time" num="0"/>
    </connection>
    <connection name="eePrmDbTime">
        <source component="eePrmDb" port="Time" type="Time" num="0"/>
        <target component="arduinoTime" port="timeGetPort" type="Time" num="0"/>
    </connection>
    <connection name="groundInterfaceTime">
        <source component="groundInterface" port="Time" type="Time" num="0"/>
        <target component="arduinoTime" port="timeGetPort" type="Time" num="0"/>
    </connection>
    <connection name="ledBlinkerTime">
        <source component="ledBlinker" port="Time" type="Time" num="0"/>
        <target component="arduinoTime" port="timeGetPort" type="Time" num="0"/>
    </connection>

    <!-- Connect the ledBlinker to a GPIO -->
    <connection name="ledGpioConn">
        <source component="ledBlinker" port="gpio" type="GpioWrite" num="0"/>
        <target component="ledGpio" port="gpioWrite" type="GpioWrite" num="0"/>
    </connection>

    <!-- Rate Group Connections -->
    <!-- Connect the Hardware Driver to the rate group driver -->
    <connection name="hardwareDriverConn">
        <source component="hardwareRateDriver" port="CycleOut" type="Cycle" num="0"/>
        <target component="rateGroupDriverComp" port="CycleIn" type="Cycle" num="0"/>
    </connection>

    <!-- Rate Group 1 -->

    <connection name="rateGroup1DriverComp">
        <source component="rateGroupDriverComp" port="CycleOut" type="Cycle" num="0"/>
        <target component="rateGroup1Comp" port="CycleIn" type="Cycle" num="0"/>
    </connection>
    <connection name="ledBlinkerRg">
        <source component="rateGroup1Comp" port="RateGroupMemberOut" type="Sched" num="0"/>
        <target component="ledBlinker" port="schedIn" type="Sched" num="0"/>
    </connection>
    <connection name="uartDriverRg">
        <source component="rateGroup1Comp" port="RateGroupMemberOut" type="Sched" num="1"/>
        <target component="uartDriver" port="reportTlm" type="Sched" num="0"/>
    </connection>
    <connection name="groundIfRg">
        <source component="rateGroup1Comp" port="RateGroupMemberOut" type="Sched" num="2"/>
        <target component="groundInterface" port="schedIn" type="Sched" num="0"/>
    </connection>
    <connection name="Rg1ChTlm">
         <source component="rateGroup1Comp" port="RateGroupMemberOut" type="Sched" num="3"/>
         <target component="chanTlm" port="Run" type="Sched" num="0"/>
    </connection>


    <!-- Rate Group 2 -->
    <!-- <connection name="Rg2Drv">
        <source component="rateGroupDriverComp" port="CycleOut" type="Cycle" num="1"/>
        <target component="rateGroup2Comp" port="CycleIn" type="Cycle" num="0"/>
    </connection>
    <connection name="Rg2Seq">
         <source component="rateGroup2Comp" port="RateGroupMemberOut" type="Sched" num="0"/>
         <target component="cmdSeq" port="schedIn" type="Sched" num="0"/>
    </connection>
    <connection name="Rg2SendBuff">
         <source component="rateGroup2Comp" port="RateGroupMemberOut" type="Sched" num="1"/>
         <target component="sendBuffComp" port="SchedIn" type="Sched" num="0"/>
    </connection> -->

    <!-- Rate Group 3 -->
    <!-- <connection name="rateGroup3DriverComp">
        <source component="rateGroupDriverComp" port="CycleOut" type="Cycle" num="2"/>
        <target component="rateGroup3Comp" port="CycleIn" type="Cycle" num="0"/>
    </connection>

    <connection name="Rg3Health">
         <source component="rateGroup3Comp" port="RateGroupMemberOut" type="Sched" num="0"/>
         <target component="health" port="Run" type="Sched" num="0"/>
    </connection>
    <connection name="Rg3BlkDrv">
         <source component="rateGroup3Comp" port="RateGroupMemberOut" type="Sched" num="2"/>
         <target component="blockDrv" port="Sched" type="Sched" num="0"/>
    </connection> -->

    <!-- Health Connections -->


    <!-- Fault Connections -->


</assembly>
